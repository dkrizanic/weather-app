# ğŸŒ¤ï¸ Weather App - DDD Architecture# Weather App - DDD Architecture



Moderna web aplikacija za prikaz vremenske prognoze s korisniÄkom autentikacijom, povijesti pretraga i statistikama. Implementirana koriÅ¡tenjem **Domain-Driven Design (DDD)** arhitekture i .NET 9.0.Web aplikacija za prikaz vremenske prognoze s korisniÄkom autentikacijom, povijesti pretraga i statistikama. Implementirana koriÅ¡tenjem Domain-Driven Design (DDD) arhitekture.



## âœ¨ ZnaÄajke## ğŸ—ï¸ Arhitektura



- âœ… **JWT autentikacija** - Sigurna registracija i prijava korisnikaProjekt je organiziran u 4 sloja prema DDD principima:

- âœ… **Widget s trenutnim vremenom** - Real-time vremenske prilike za bilo koji grad ili lokaciju

- âœ… **5-dnevna prognoza** - Detaljni prikaz prognoze s gridovima i chartovima- **Domain**: Entiteti i repository interfaceovi (User, SearchHistory)

- âœ… **Povijest pretraga** - Automatsko spremanje svih pretraga u bazu- **Application**: DTOs, servisi interfaceovi, controlleri

- âœ… **Statistike** - Top gradovi, najnovije pretrage, distribucija vremenskih uvjeta- **Infrastructure**: Implementacija servisa, repositories, DbContext

- âœ… **Docker setup** - Ready-to-run Docker Compose konfiguracija- **WeatherApp.Api**: Entry point, dependency injection, konfiguracija



## ğŸ—ï¸ Arhitektura (DDD Layers)## ğŸ› ï¸ Tehnologije



```### Backend

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”- .NET 9.0

â”‚         WeatherApp.Api (Entry Point)    â”‚- PostgreSQL 16

â”‚    Controllers, DI, Configuration       â”‚- Entity Framework Core

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜- JWT autentikacija

             â”‚- BCrypt za hashiranje lozinki

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”- OpenWeather API

â”‚        Application Layer                â”‚

â”‚   DTOs, Interfaces, Controllers         â”‚### Frontend (TBD)

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜- React + TypeScript

             â”‚- Recharts za grafove

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”- Axios za HTTP pozive

â”‚      Infrastructure Layer               â”‚

â”‚  DbContext, Repositories, Services      â”‚## ğŸš€ Pokretanje aplikacije

â”‚  (EF Core, PostgreSQL, OpenWeather)     â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜### Preduvjeti

             â”‚- Docker i Docker Compose

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”- OpenWeather API kljuÄ (besplatan na https://openweathermap.org)

â”‚          Domain Layer                   â”‚

â”‚    Entities, Repository Interfaces      â”‚### Setup

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```1. **Kloniraj repository**

```bash

### Layerigit clone https://github.com/dkrizanic/weather-app.git

cd weather-app

**Domain** - ÄŒisti domain modeli bez ovisnosti```

- `User`, `SearchHistory` entiteti

- Repository interfaceovi2. **Kreiraj `.env` fajl**

```bash

**Application** - Business logika i interfaceovicp .env.example .env

- DTOs za request/response```

- Service interfaceovi

- API Controllers3. **Dodaj OpenWeather API kljuÄ u `.env`**

```

**Infrastructure** - Implementacija eksternih servisaOPENWEATHER_API_KEY=tvoj_api_kljuc

- Entity Framework DbContext```

- PostgreSQL repositories

- OpenWeather API client4. **Pokreni Docker Compose**

- JWT service```bash

docker-compose up --build

**WeatherApp.Api** - Entry point```

- Dependency Injection setup

- Middleware konfiguracijaAPI Ä‡e biti dostupan na: `http://localhost:5000`

- CORS, Authentication

### Pokretanje bez Dockera

## ğŸ› ï¸ Tehnologije

1. **Instaliraj PostgreSQL lokalno**

### Backend

- **.NET 9.0** - Latest .NET framework2. **AÅ¾uriraj connection string u `appsettings.json`**

- **PostgreSQL 16** - Relational database

- **Entity Framework Core** - ORM3. **Kreiraj database**

- **JWT** - Stateless authentication```bash

- **BCrypt** - Password hashingcd WeatherApp.Api

- **OpenWeather API** - Weather data providerdotnet ef migrations add InitialCreate --project ../Infrastructure

dotnet ef database update --project ../Infrastructure

## ğŸš€ Brzi Start```



### Preduvjeti4. **Pokreni aplikaciju**

- [Docker Desktop](https://www.docker.com/products/docker-desktop)```bash

- [OpenWeather API kljuÄ](https://openweathermap.org/api) (besplatan)dotnet run --project WeatherApp.Api

```

### 1. Kloniraj repository

```bash## ğŸ“‹ API Endpointi

git clone https://github.com/dkrizanic/weather-app.git

cd weather-app### Autentikacija

```- `POST /api/auth/register` - Registracija novog korisnika

- `POST /api/auth/login` - Prijava korisnika

### 2. Konfiguracija

### Vrijeme (zahtijeva JWT token)

Kreiraj `.env` fajl u root direktoriju:- `GET /api/weather/current/{city}` - Trenutno vrijeme za grad

```bash- `GET /api/weather/current/coordinates?lat={lat}&lon={lon}` - Trenutno vrijeme po koordinatama

cp .env.example .env- `POST /api/weather/forecast` - 5-dnevna prognoza (sprema u povijest)

```- `GET /api/weather/history` - Povijest pretraga korisnika

- `GET /api/weather/statistics` - Statistike korisnika (top gradovi, zadnje pretrage, distribucija)

Uredi `.env` i dodaj svoj OpenWeather API kljuÄ:

```env## ğŸ“Š Funkcionalnosti

OPENWEATHER_API_KEY=tvoj_api_kljuc_ovdje

```âœ… **Autentikacija**

- Registracija i prijava korisnika

### 3. Pokreni s Docker Compose- JWT token autentikacija

```bash- BCrypt hashiranje lozinki

docker-compose up --build

```âœ… **Widget s trenutnim vremenom**

- Prikaz trenutnih vremenskih prilika

API Ä‡e biti dostupan na: **http://localhost:5000**  - Pretraga po gradu ili koordinatama

Swagger UI: **http://localhost:5000/swagger**

âœ… **5-dnevna prognoza**

### 4. Testiranje API-ja- Grid i chart prikaz

- Filtriranje po parametrima

**Registracija**:

```bashâœ… **Povijest pretraga**

curl -X POST http://localhost:5000/api/auth/register \- Spremanje svake pretrage u bazu

  -H "Content-Type: application/json" \- Prikaz svih prethodnih pretraga

  -d '{"username":"test","email":"test@example.com","password":"Test123!"}'

```âœ… **Statistike**

- Top 3 najÄeÅ¡Ä‡e pretraÅ¾ivanih gradova

**Prijava**:- 3 najnovije pretrage

```bash- Distribucija vremenskih uvjeta

curl -X POST http://localhost:5000/api/auth/login \

  -H "Content-Type: application/json" \## ğŸ—‚ï¸ Struktura projekta

  -d '{"email":"test@example.com","password":"Test123!"}'

``````

weather-app/

**Trenutno vrijeme** (zahtijeva token):â”œâ”€â”€ Domain/                    # Domain layer

```bashâ”‚   â”œâ”€â”€ Entities/

curl -X GET http://localhost:5000/api/weather/current/Zagreb \â”‚   â”‚   â”œâ”€â”€ User.cs

  -H "Authorization: Bearer YOUR_JWT_TOKEN"â”‚   â”‚   â””â”€â”€ SearchHistory.cs

```â”‚   â””â”€â”€ Interfaces/

â”‚       â”œâ”€â”€ IUserRepository.cs

## ğŸ’» Lokalni Development (bez Dockera)â”‚       â””â”€â”€ ISearchHistoryRepository.cs

â”œâ”€â”€ Application/               # Application layer

### Preduvjetiâ”‚   â”œâ”€â”€ Controllers/

- [.NET 9.0 SDK](https://dotnet.microsoft.com/download)â”‚   â”‚   â”œâ”€â”€ AuthController.cs

- [PostgreSQL 16](https://www.postgresql.org/download/)â”‚   â”‚   â””â”€â”€ WeatherController.cs

â”‚   â”œâ”€â”€ DTOs/

### Setupâ”‚   â”‚   â”œâ”€â”€ AuthDtos.cs

â”‚   â”‚   â”œâ”€â”€ WeatherDtos.cs

1. **Kreiraj PostgreSQL bazu**â”‚   â”‚   â””â”€â”€ StatisticsDtos.cs

```sqlâ”‚   â””â”€â”€ Interfaces/

CREATE DATABASE weatherapp;â”‚       â”œâ”€â”€ IAuthService.cs

```â”‚       â”œâ”€â”€ IWeatherService.cs

â”‚       â””â”€â”€ ISearchHistoryService.cs

2. **AÅ¾uriraj `appsettings.json`**â”œâ”€â”€ Infrastructure/            # Infrastructure layer

```jsonâ”‚   â”œâ”€â”€ Data/

{â”‚   â”‚   â””â”€â”€ ApplicationDbContext.cs

  "ConnectionStrings": {â”‚   â”œâ”€â”€ Repositories/

    "DefaultConnection": "Host=localhost;Port=5432;Database=weatherapp;Username=postgres;Password=your_password"â”‚   â”‚   â”œâ”€â”€ UserRepository.cs

  },â”‚   â”‚   â””â”€â”€ SearchHistoryRepository.cs

  "JwtSettings": {â”‚   â””â”€â”€ Services/

    "SecretKey": "YourSuperSecretKeyForJWT_MinimumLength32Characters!",â”‚       â”œâ”€â”€ AuthService.cs

    "Issuer": "WeatherApp",â”‚       â”œâ”€â”€ WeatherService.cs

    "Audience": "WeatherAppUsers"â”‚       â””â”€â”€ SearchHistoryService.cs

  },â”œâ”€â”€ WeatherApp.Api/           # Entry point

  "OpenWeather": {â”‚   â”œâ”€â”€ Program.cs

    "ApiKey": "YOUR_OPENWEATHER_API_KEY"â”‚   â””â”€â”€ appsettings.json

  }â”œâ”€â”€ Dockerfile

}â”œâ”€â”€ docker-compose.yml

```â””â”€â”€ README.md

```

3. **Primijeni migracije**

```bash## ğŸ”§ Konfiguracija

cd WeatherApp.Api

dotnet ef database update --project ../Infrastructure### JWT Settings (`appsettings.json`)

``````json

"JwtSettings": {

4. **Pokreni aplikaciju**  "SecretKey": "YourSuperSecretKeyForJWT_MinimumLength32Characters!",

```bash  "Issuer": "WeatherApp",

dotnet run  "Audience": "WeatherAppUsers"

```}

```

API: `https://localhost:7001` ili `http://localhost:5000`

### Database Connection

## ğŸ“‹ API Dokumentacija```json

"ConnectionStrings": {

### Autentikacija  "DefaultConnection": "Host=localhost;Port=5432;Database=weatherapp;Username=postgres;Password=postgres"

}

#### POST `/api/auth/register````

Registracija novog korisnika

## ğŸ“ Migracije

**Request:**

```jsonKreiranje nove migracije:

{```bash

  "username": "john_doe",dotnet ef migrations add MigrationName --project Infrastructure --startup-project WeatherApp.Api

  "email": "john@example.com",```

  "password": "SecurePass123!"

}Primjena migracija:

``````bash

dotnet ef database update --project Infrastructure --startup-project WeatherApp.Api

#### POST `/api/auth/login````

Prijava postojeÄ‡eg korisnika

## ğŸ§ª Testiranje

### Vrijeme (Zahtijeva JWT token u Authorization headeru)

TODO: Dodati unit i integration testove

#### GET `/api/weather/current/{city}`

Trenutno vrijeme za grad## ğŸ“„ Licenca



#### GET `/api/weather/current/coordinates?lat={lat}&lon={lon}`MIT
Trenutno vrijeme po geografskim koordinatama

#### POST `/api/weather/forecast`
5-dnevna prognoza (automatski sprema u povijest)

#### GET `/api/weather/history`
Povijest svih korisniÄkih pretraga

#### GET `/api/weather/statistics`
Statistike korisnika

## ğŸ—‚ï¸ Struktura Projekta

```
weather-app/
â”œâ”€â”€ Domain/                          # Domain Layer
â”‚   â”œâ”€â”€ Entities/
â”‚   â”‚   â”œâ”€â”€ User.cs                  
â”‚   â”‚   â””â”€â”€ SearchHistory.cs         
â”‚   â””â”€â”€ Interfaces/
â”‚       â”œâ”€â”€ IUserRepository.cs
â”‚       â””â”€â”€ ISearchHistoryRepository.cs
â”‚
â”œâ”€â”€ Application/                     # Application Layer
â”‚   â”œâ”€â”€ Controllers/
â”‚   â”‚   â”œâ”€â”€ AuthController.cs        
â”‚   â”‚   â””â”€â”€ WeatherController.cs     
â”‚   â”œâ”€â”€ DTOs/
â”‚   â”‚   â”œâ”€â”€ AuthDtos.cs             
â”‚   â”‚   â”œâ”€â”€ WeatherDtos.cs          
â”‚   â”‚   â””â”€â”€ StatisticsDtos.cs       
â”‚   â””â”€â”€ Interfaces/
â”‚       â”œâ”€â”€ IAuthService.cs
â”‚       â”œâ”€â”€ IWeatherService.cs
â”‚       â””â”€â”€ ISearchHistoryService.cs
â”‚
â”œâ”€â”€ Infrastructure/                  # Infrastructure Layer
â”‚   â”œâ”€â”€ Data/
â”‚   â”‚   â”œâ”€â”€ ApplicationDbContext.cs  
â”‚   â”‚   â””â”€â”€ Migrations/              
â”‚   â”œâ”€â”€ Repositories/
â”‚   â”‚   â”œâ”€â”€ UserRepository.cs
â”‚   â”‚   â””â”€â”€ SearchHistoryRepository.cs
â”‚   â””â”€â”€ Services/
â”‚       â”œâ”€â”€ AuthService.cs           
â”‚       â”œâ”€â”€ WeatherService.cs        
â”‚       â””â”€â”€ SearchHistoryService.cs
â”‚
â”œâ”€â”€ WeatherApp.Api/                  # Entry Point
â”‚   â”œâ”€â”€ Program.cs                   
â”‚   â”œâ”€â”€ appsettings.json            
â”‚   â””â”€â”€ WeatherApp.Api.csproj
â”‚
â”œâ”€â”€ docker-compose.yml               
â”œâ”€â”€ Dockerfile                       
â”œâ”€â”€ .env.example                     
â””â”€â”€ README.md
```

## ğŸ”§ Konfiguracija

### Database Connection String
```json
"ConnectionStrings": {
  "DefaultConnection": "Host=postgres;Port=5432;Database=weatherapp;Username=postgres;Password=postgres"
}
```

Za lokalni development koristi `Host=localhost`.

### JWT Settings
```json
"JwtSettings": {
  "SecretKey": "minimum_32_characters_secret_key_here",
  "Issuer": "WeatherApp",
  "Audience": "WeatherAppUsers"
}
```

âš ï¸ **VAÅ½NO**: Promijeni `SecretKey` u produkciji!

### OpenWeather API
```json
"OpenWeather": {
  "ApiKey": "your_api_key_from_openweathermap_org"
}
```

Besplatan API kljuÄ: https://openweathermap.org/api

## ğŸ”„ EF Core Migracije

### Kreiranje nove migracije
```bash
dotnet ef migrations add MigrationName \
  --project Infrastructure \
  --startup-project WeatherApp.Api
```

### Primjena migracija
```bash
dotnet ef database update \
  --project Infrastructure \
  --startup-project WeatherApp.Api
```

## ğŸ³ Docker

### Docker Compose
```bash
# Start
docker-compose up -d

# Logs
docker-compose logs -f api

# Stop
docker-compose down
```

## ğŸ“Š Database Schema

### Users Table
- Id (string, PK)
- Username (string, UNIQUE)
- Email (string, UNIQUE)
- PasswordHash (string)
- CreatedAt (datetime)

### SearchHistories Table
- Id (int, PK)
- UserId (string, FK)
- City (string)
- Country (string)
- SearchDate (datetime)
- WeatherCondition (string)
- Temperature (double)
- Description (string)
- Period (string)

## ğŸ“„ Licenca

MIT

## ğŸ‘¤ Autor

**Dario KriÅ¾aniÄ‡**
- GitHub: [@dkrizanic](https://github.com/dkrizanic)
